<html>

<body>


	<link rel="stylesheet" href="style.css" />

	<div id="div_Sign">
		Willkommen - Anmeldung erforderlich! <br><br>
		Name:<br><input id="input_Username" type="text"></input><br>
		Passwort:<br><input id="input_Password" type="password"></input><br><br>
		<button id="button_SignIn">Anmelden</button>
		<button id="button_SignUp">Registrieren</button>
		<br>
	</div>


	<div id="div_PersonalOverview" class="tab">
		<div id="div_PersonalInfo">
			<div id="div_personalTable">
				<table id="table_personalTable" class="std_table">
					<thead></thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
		<div id="div_addWorkout">
			<label for="input_doneExerciseDate">Übung Datum :</label>
			<input id="input_doneExerciseDate" type="date"></input><br>
			<label for="select_doneExercise">Übung :</label>
			<select id="select_doneExercise"></select><br>
			<label for="input_doneExercise">Übung Anzahl :</label>
			<input id="input_doneExercise" type="number"></input><br>
			<label for="input_doneExerciseWeight">Übung Gewicht [kg]:</label>
			<input id="input_doneExerciseWeight" type="number"></input><br>
			<button id="button_doneExerciseSend">Absenden</button>
		</div>
		<div id="div_exerciseHistory">
			<table id="table_exerciseHistory" class="std_table">
				<thead></thead>
				<tbody></tbody>
			</table>
		</div>
	</div>



	<div id="div_ExerciseOverview" class="tab">
		<div id="div_addNewExercise">
			<label for="input_exerciseName">Name :</label>
			<input id="input_exerciseName" type="text"></input><br>

			<label for="input_exerciseDifficulty">Schwierigkeit (1,10,100):</label>
			<input id="input_exerciseDifficulty" type="number"><input id="input_exerciseDifficulty10"
				type="number"><input id="input_exerciseDifficulty100" type="number"></input><br>

			<label for="input_exerciseBaseWeight">Basisgewicht:</label>
			<input id="input_exerciseBaseWeight" type="number"></input><br>

			<label for="select_exerciseType">Typ :</label>
			<select id="select_exerciseType">
				<option value="Cardio">Cardio</option>
				<option value="Kraft">Kraft</option>
			</select><br>

			<label for="select_exerciseUnit">Einheit :</label>
			<select id="select_exerciseUnit">
				<option value="km">km</option>
				<option value="m">m</option>
				<option value="Wdh">Wdh</option>
				<option value="sec">sec</option>
				<option value="min">min</option>
				<option value="h">h</option>
				<option value="Schwung">Schwung</option>
			</select><br>
			<label for="select_exerciseEquipment">Ausrüstung :</label>
			<select id="select_exerciseEquipment">
				<option value="Sprungseil">Sprungseil</option>
				<option value="Widerstandsband (Leicht)">Widerstandsband (Leicht)</option>
				<option value="Widerstandsband (Mittel)">Widerstandsband (Mittel)</option>
				<option value="Widerstandsband (Schwer)">Widerstandsband (Schwer)</option>
				<option value="Langhantel">Langhantel</option>
				<option value="Hantel">Hantel</option>
				<option value="2x Hantel">2x Hantel</option>
				<option value="Körpergewicht">Körpergewicht</option>
				<option value="Rudergerät">Rudergerät</option>
				<option value="Fahrrad">Fahrrad</option>
			</select><br>
			<label for="input_exerciseComment">Kommentar :</label>
			<input id="input_exerciseComment" type="text"></input><br>
			<button id="button_createExercise">Absenden</button>
			<button id="button_deleteExercise">Löschen</button>
		</div>

		<div id="div_exerciseTable">
			<table id="table_exerciseTable" class="std_table">
				<thead></thead>
				<tbody></tbody>
			</table>
		</div>
	</div>

	<div id="div_navigation">
		<button id="button_tabExerciseOverview">Übungsübersicht</button>
		<button id="button_tabPersonalOverview">Persönliche Übersicht</button>
	</div>
</body>

</html>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
<script>


	// @ts-nocheck
	/*jshint esversion: 6 */
	var Name = "";

	//BUTTONS
	var button_SignIn = document.getElementById('button_SignIn');
	var button_SignUp = document.getElementById('button_SignUp');
	var button_createExercise = document.getElementById('button_createExercise');
	var button_deleteExercise = document.getElementById('button_deleteExercise');
	var button_tabExerciseOverview = document.getElementById('button_tabExerciseOverview');
	var button_tabPersonalOverview = document.getElementById('button_tabPersonalOverview');
	var button_doneExerciseSend = document.getElementById('button_doneExerciseSend');
	//CANVAS

	//CTX

	//DIVS
	var div_Sign = document.getElementById('div_Sign');
	var div_ExerciseOverview = document.getElementById('div_ExerciseOverview');
	var div_addNewExercise = document.getElementById('div_addNewExercise');
	var div_navigation = document.getElementById('div_navigation');
	var div_PersonalOverview = document.getElementById('div_PersonalOverview');
	var div_addWorkout = document.getElementById('div_addWorkout');
	var div_PersonalInfo = document.getElementById('div_PersonalInfo');
	var div_exerciseHistory = document.getElementById('div_exerciseHistory');

	//FONTS
	var font_Courier = "Courier New";
	//INPUTS
	var input_Password = document.getElementById('input_Password');
	var input_UserName = document.getElementById('input_Username');
	var input_exerciseName = document.getElementById('input_exerciseName');
	var input_exerciseDifficulty = document.getElementById('input_exerciseDifficulty');
	var input_exerciseDifficulty10 = document.getElementById('input_exerciseDifficulty10');
	var input_exerciseDifficulty100 = document.getElementById('input_exerciseDifficulty100');
	var input_exerciseBaseWeight = document.getElementById('input_exerciseBaseWeight');
	var input_exerciseComment = document.getElementById('input_exerciseComment');
	var input_doneExerciseDate = document.getElementById('input_doneExerciseDate');
	var input_doneExercise = document.getElementById('input_doneExercise');
	var input_doneExerciseWeight = document.getElementById('input_doneExerciseWeight');
	//SELECTS
	var select_exerciseType = document.getElementById('select_exerciseType');
	var select_exerciseUnit = document.getElementById('select_exerciseUnit');
	var select_exerciseEquipment = document.getElementById('select_exerciseEquipment');
	var select_doneExercise = document.getElementById('select_doneExercise');
	//TABLES
	var table_exerciseTable = document.getElementById('table_exerciseTable');
	var table_personalTable = document.getElementById('table_personalTable');
	var table_exerciseHistory = document.getElementById('table_exerciseHistory');
	var socket = io();


	var screenLog = document.querySelector('#screen-log');
	document.addEventListener('mousemove', logKey);


	//sign in code
	button_SignIn.onclick = function () {
		socket.emit('SignIn', { username: input_UserName.value, password: input_Password.value });
	};
	button_SignUp.onclick = function () {
		socket.emit('SignUp', { username: input_UserName.value, password: input_Password.value });
	};
	socket.on('signInResponse', function (data) {
		if (data.success) {
			Name = input_UserName.value;
			div_Sign.style.display = 'none';
			div_ExerciseOverview.style.display = 'inline-block';
			div_navigation.style.display = 'inline-block'; ""
		}
		else
			alert("Sign in unsuccessful");
	});

	socket.on('signUpResponse', function (data) {
		if (data.success) {
			alert("Sign Up successful");
		}
		else
			alert("Sign Up unsuccessful");
	});

	button_doneExerciseSend.onclick = function () {
		if (checkForEmptyBoxesDoneExercise()) {
			exerciseDone('addDoneExercise');
		}
		else {
			alert("Nicht alle Inputboxen wurden ausgefüllt!")
		}
	}

	button_tabPersonalOverview.onclick = function () {
		div_ExerciseOverview.style.display = "none";
		div_PersonalOverview.style.display = "inline-block";
	}


	button_tabExerciseOverview.onclick = function () {
		div_ExerciseOverview.style.display = "inline-block";
		div_PersonalOverview.style.display = "none";
	}

	button_deleteExercise.onclick = function () {
		if (checkForEmptyBoxesNewExercise()) {
			modifyExercise('deleteExercise')
		}
		else {
			alert("Nicht alle Inputboxen wurden ausgefüllt!")
		}
	}


	button_createExercise.onclick = function () {
		if (checkForEmptyBoxesNewExercise()) {
			modifyExercise('addExercise')
		}
		else {
			alert("Nicht alle Inputboxen wurden ausgefüllt!")
		}

	}


	socket.on("refresh", function (data) {
		generateExerciseList(data);
		generatePlayerInfoTable(data);
		generateHistoryList(data);

	});

	function generatePlayerInfoTable(data) {
		var theadPersonalTable = table_personalTable.tHead;
		var tBodyPersonalTable = table_personalTable.tBodies[0];

		theadPersonalTable.innerHTML = "";
		tBodyPersonalTable.innerHTML = "";

		headerRow = theadPersonalTable.insertRow(0);
		bodyRow = tBodyPersonalTable.insertRow(0);
		var cellNumber = 0;
		for (playerKeyName in data.player) {
			playerKeyContent = data.player[playerKeyName];
			if (playerKeyName === "regDate") {
				playerKeyContent = new Date(playerKeyContent);
				playerKeyContent = playerKeyContent.toLocaleDateString();
			}
			if (Object.keys(playerKeyContent).length > 0 && !checkIfString(playerKeyContent)) {
				for (objectKeyName in playerKeyContent) {
					objectKeyContent = playerKeyContent[objectKeyName];
					cell = headerRow.insertCell(cellNumber);
					cell.innerHTML += translate(objectKeyName)
					cell = bodyRow.insertCell(cellNumber);
					cell.innerHTML += translate(objectKeyContent);
					cellNumber++;
				}
			}
			else {
				cell = headerRow.insertCell(cellNumber);
				cell.innerHTML += translate(playerKeyName);
				cell = bodyRow.insertCell(cellNumber);
				cell.innerHTML += translate(playerKeyContent);
				cellNumber++;
			}
		}
	}

	function generateExerciseList(data) {
		var theadExerciseTable = table_exerciseTable.tHead;
		var tBodyExerciseTable = table_exerciseTable.tBodies[0];
		tBodyExerciseTable.innerHTML = "";
		theadExerciseTable.innerHTML = "";
		var headerArray = [];
		var cell;
		var rowNumber = 0;
		var selIndex = select_doneExercise.selectedIndex;
		select_doneExercise.innerHTML = "";

		for (exerciseId in data.exercises) {
			exercise = data.exercises[exerciseId];
			addOption(select_doneExercise, exerciseId, exercise.name + " (" + exercise.unit + ")" + " | " + exercise.equipment + " | " + exercise.factor);

			bodyRow = tBodyExerciseTable.insertRow(rowNumber);
			rowNumber++;
			var cellNumber = 0;
			var toolTipText = "";
			for (exerciseKeys in exercise) {
				key = exercise[exerciseKeys];

				if (exerciseKeys === "comment") {
					continue;
				}
				if (exerciseKeys === "votes") {
					for (voters in key) {
						content = key[voters];
						toolTipText += voters + ": <br>";
						for (contentItemNum in content) {
							contentItem = content[contentItemNum];
							toolTipText += translate(contentItemNum) + ": " + contentItem.toString() + "<br>";
						}
					}
					continue;
				}
				if (rowNumber == 1) {
					headerArray.push(exerciseKeys);
				}
				cell = bodyRow.insertCell(cellNumber);
				cell.innerHTML = translate(key);
				if (exerciseKeys === "id") {
					cell.classList.add("hiddenCell")
				}
				cellNumber++;
			}
			addToolTip(toolTipText, "tooltip", bodyRow);

			bodyRow.onclick = function () {
				var id = this.getElementsByTagName("td")[0].innerHTML;
				input_exerciseName.value = data.exercises[id].name;
				input_exerciseBaseWeight.value = data.exercises[id].votes[Name].baseWeight;
				input_exerciseDifficulty.value = data.exercises[id].votes[Name].difficulty;
				input_exerciseDifficulty10.value = data.exercises[id].votes[Name].difficulty10;
				input_exerciseDifficulty100.value = data.exercises[id].votes[Name].difficulty100;
				input_exerciseComment.value = data.exercises[id].votes[Name].comment;
				select_exerciseEquipment.value = data.exercises[id].equipment;
				select_exerciseType.value = data.exercises[id].type;
				select_exerciseUnit.value = data.exercises[id].unit;
			}
		}
		select_doneExercise.selectedIndex = selIndex;
		headerRow = theadExerciseTable.insertRow(0);

		for (headerContents = 0; headerContents < headerArray.length; headerContents++) {

			cell = headerRow.insertCell(headerContents);
			cell.innerHTML = translate(headerArray[headerContents]);
			if (headerArray[headerContents] === "id") {
				cell.classList.add("hiddenCell")
			}
			cell.onclick = function () {
				sortTable(this, table_exerciseTable)

			};

		}
	}

	function generateHistoryList(data) {
		var theadExerciseHistory = table_exerciseHistory.tHead;
		var tBodyExerciseHistory = table_exerciseHistory.tBodies[0];
		tBodyExerciseHistory.innerHTML = "";
		theadExerciseHistory.innerHTML = "";
		var headerArray = [];
		var cell;
		var rowNumber = 0;


		for (historyId in data.history) {
			historyEntry = data.history[historyId];
			bodyRow = tBodyExerciseHistory.insertRow(rowNumber);
			rowNumber++;
			var cellNumber = 0;
			var toolTipText = "No Text";
			for (historyKeys in historyEntry) {
				if (historyKeys === "exerciseId" || historyKeys === "playerName") {
					continue;
				}
				key = historyEntry[historyKeys];
				if (historyKeys === "date") {
					key = new Date(key);
					key = key.toLocaleDateString();
				}
				if (rowNumber == 1) {
					headerArray.push(historyKeys);
				}
				cell = bodyRow.insertCell(cellNumber);
				cell.innerHTML = translate(key);
				
				cellNumber++;
			}
			addToolTip(toolTipText, "tooltip", bodyRow);

			bodyRow.onclick = function () {
				alert("no click");
			}
		}
		headerRow = theadExerciseHistory.insertRow(0);

		for (headerContents = 0; headerContents < headerArray.length; headerContents++) {

			cell = headerRow.insertCell(headerContents);
			cell.innerHTML = translate(headerArray[headerContents]);
			if (headerArray[headerContents] === "id") {
				cell.classList.add("hiddenCell")
			}
			cell.onclick = function () {
				sortTable(this, table_exerciseHistory)

			};

		}
	}

	function addOption(select, key, Name) {
		var option = document.createElement('option');
		option.text = Name;
		option.value = key;
		select.add(option);
	}

	function checkForEmptyBoxesDoneExercise() {
		if (input_doneExercise.value != "" &&
			input_doneExerciseDate.value != "" &&
			input_doneExerciseWeight.value != "" &&
			select_doneExercise.value != ""
		) {
			return true;
		}
		else {
			return false;
		}
	}

	function checkForEmptyBoxesNewExercise() {
		if (input_exerciseName.value != "" &&
			input_exerciseDifficulty.value != "" &&
			input_exerciseDifficulty10.value != "" &&
			input_exerciseDifficulty100.value != "" &&
			input_exerciseBaseWeight.value != "" &&
			select_exerciseType.value != "" &&
			select_exerciseUnit.value != "" &&
			select_exerciseEquipment.value != "" &&
			input_exerciseComment.value != ""
		) {
			return true;
		}
		else {
			return false;
		}
	}

	function exerciseDone(emitString) {
		socket.emit(emitString, exPack = {
			exId: select_doneExercise.value,
			date: input_doneExerciseDate.value,
			count: input_doneExercise.value,
			weight: input_doneExerciseWeight.value,
		});
	}

	function modifyExercise(emitString) {
		socket.emit(emitString, exPack = {
			name: input_exerciseName.value,
			difficulty: input_exerciseDifficulty.value,
			difficulty10: input_exerciseDifficulty10.value,
			difficulty100: input_exerciseDifficulty100.value,
			baseWeight: input_exerciseBaseWeight.value,
			type: select_exerciseType.value,
			unit: select_exerciseUnit.value,
			equipment: select_exerciseEquipment.value,
			comment: input_exerciseComment.value,
		});
	}


	function checkIfString(value) {
		return Object.prototype.toString.call(playerKeyContent) === "[object String]"
	}

	function checkIfDate(value) {
		return Object.prototype.toString.call(value) === "[object Date]"
	}

	function checkIfNumber(value){
		return (typeof value == 'number');
			
		
	}

	function addToolTip(toolTipText, toolTipClass, element) {
		element.classList.add(toolTipClass);
		element.innerHTML += "<span class=\"tooltiptext\">" + toolTipText + "</span>"

	}

	//Creates an Image on a given canvas
	function createImage(ctx, pictureUrl, x, y) {
		ctx.beginPath();
		drawing = new Image();
		drawing.src = "/client/img/" + pictureUrl;
		ctx.drawImage(drawing, x, y);
		ctx.stroke();
		ctx.closePath();
	}

	//Creates a Sprite Image on a given canvas
	function createSprite(ctx, sx, sy, sWidth, sHeight, x, y, dWidth, dHeight) {
		ctx.beginPath();
		ctx.drawImage(gameAssets.spriteSheet, sx, sy, sWidth, sHeight, x, y, dWidth, dHeight);
		ctx.stroke();
		ctx.closePath();

	}
	//Creates simple good old text on a given canvas
	function createText(ctx, fillStyle, font, fontsize, text, x, y) {
		fontAndSize = fontsize.toString() + "px " + font;
		ctx.beginPath();
		ctx.font = fontAndSize;
		ctx.fillStyle = fillStyle;
		ctx.fillText(text, x, y);
		ctx.stroke();
		ctx.closePath();

	}
	//Creates rect (filled or unfilled) on a given canvas
	function createRect(ctx, fillStyle, fill, x, y, w, h) {

		ctx.beginPath();
		ctx.fillStyle = fillStyle;
		if (fill) {
			ctx.fillRect(x, y, w, h);
		}
		else {
			ctx.rect(x, y, w, h);
		}

		ctx.stroke();
		ctx.closePath();

	}
	//checks if clients mousepos is on the side of the browser and if so, scrolls
	function logKey(e) {
		var maxX = e.view.outerWidth;
		var maxY = e.view.outerHeight;

		xPercent = (e.clientX / maxX) * 100;
		yPercent = (e.clientY / maxY) * 100;

	}
	//scrolls by x,y
	function scroll(x, y) {
		div_Game.scrollBy(x, y);
	}


	//keyboard input
	/**
	*
	*
	*/
	document.onkeydown = function (event) {
		if (event.keyCode === 49) //1
			button_tabExerciseOverview.onclick();
		else if (event.keyCode === 50) //2
			button_tabPersonalOverview.onclick();
	};


	function dragElement(elmnt) {
		var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
		if (document.getElementById(elmnt.id)) {
			// if present, the header is where you move the DIV from:
			document.getElementById(elmnt.id).onmousedown = dragMouseDown;
		} else {
			// otherwise, move the DIV from anywhere inside the DIV: 
			elmnt.onmousedown = dragMouseDown;
		}

		function dragMouseDown(e) {
			e = e || window.event;
			e.preventDefault();
			// get the mouse cursor position at startup:
			pos3 = e.clientX;
			pos4 = e.clientY;
			document.onmouseup = closeDragElement;
			// call a function whenever the cursor moves:
			document.onmousemove = elementDrag;
		}

		function elementDrag(e) {
			e = e || window.event;
			e.preventDefault();
			// calculate the new cursor position:
			pos1 = pos3 - e.clientX;
			pos2 = pos4 - e.clientY;
			pos3 = e.clientX;
			pos4 = e.clientY;
			// set the element's new position:
			elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
			elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
		}

		function closeDragElement() {
			// stop moving when mouse button is released:
			document.onmouseup = null;
			document.onmousemove = null;
		}
	}

	function sortTable(n, table) {
		m = n.cellIndex;
		var rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
		switching = true;
		dir = "asc";
		while (switching) {
			switching = false;
			rows = table.rows;
			for (i = 1; i < (rows.length - 1); i++) {
				shouldSwitch = false;
				x = rows[i].getElementsByTagName("td")[m];
				y = rows[i + 1].getElementsByTagName("td")[m];
				if (dir == "asc") {
					if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
						shouldSwitch = true;
						break;
					}
				} else if (dir == "desc") {
					if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
						shouldSwitch = true;
						break;
					}
				}
			}
			if (shouldSwitch) {
				rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
				switching = true;
				switchcount++;
			} else {
				if (switchcount == 0 && dir == "asc") {
					dir = "desc";
					switching = true;
				}
			}
		}
	}

	function addSpaces(count) {
		var spaces = "";
		for (i = 0; i < count; i++) {
			spaces += " ";
		}
		return spaces;
	}

	function translate(word) {
		if(checkIfNumber(word)){	
			return word.toFixed(2);
		}
		word = word.toString();
		switch (word) {
			case "name":
				return "Name";
			case "factor":
				return "Faktor";
			case "points":
				return "Punkte";
			case "difficulty":
				return "Schwierigkeit";
			case "type":
				return "Typ";
			case "unit":
				return "Einheit";
			case "usesWeight":
				return "Gewichtsabhängig";
			case "baseWeight":
				return "Basisgewicht";
			case "creator":
				return "Ersteller";
			case "false":
				return "Nein";
			case "true":
				return "Ja";
			case "cardio":
				return "Cardio";
			case "non-cardio":
				return "Kraft";
			case "equipment":
				return "Ausrüstung";
			case "0":
				return "-";
			case "difficulty10":
				return "Schwierigkeit für 10";
			case "difficulty100":
				return "Schwierigkeit für 100";
			case "id":
				return "Verbindungs-Id";
			case "active":
				return "Aktiv";
			case "regDate":
				return "Registrierungsdatum";
			case "points":
				return "Punkte";
			case "today":
				return "Heute";
			case "last5Days":
				return "Letzte 5 Tage";
			case "total":
				return "Total";
			case "comment":
				return "Kommentar";
			case "addedExercises":
				return "Übungen angelegt";
			case "deletedExercises":
				return "Übungen gelöscht";
			case "modifiedExercises":
				return "Übungen angepasst";
			case "negative":
				return "Negativpunkte";
			case "thisMonth":
				return "Dieser Monat";
			case "diffLastMonth":
				return "Differenz Vormonat";
			case "averageThisMonth":
				return "Durchschnitt (Monat)";
			case "date":
				return "Datum";
			case "playerName":
				return "Name";
			case "count":
				return "Anzahl";
			case "weight":
				return "Benutztes Gewicht";
			default:
				return word;
		}
	}


</script>